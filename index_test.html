<!DOCTYPE html>
<html>
    <head>
        <title>Pigsty Tracking</title>

        <link  type="text/html" href="global.css" />
        <link  type="text/html" href="index.css" />
    </head>
    <body>
        <div id="display">
        </div>
        <div>
            <button id="button" value="Click">Click</button><br>
        </div>

        <p1></p1>
        <form id="inputForm">
            <label for="idlb">Mã số:</label>
            <input type="text" id="idTextBox" name="idTextBox"><br><br>
            <label for="weightlb">Cân nặng:</label>
            <input type="text" id="weightTextBox" name="weightTextBox"><br><br>
            <input type="submit" id="submit" value="Submit">
        </form>

        <img class="bifan-icon" alt="Fan" src="bifan.svg">
        <input type="hidden" id="hiddenTextBox">

        <script src="/socket.io/socket.io.js"></script>
        <script>
            var socket = io();
            var display = document.getElementById('display');
            var button = document.getElementById('button');

            var idTextBox = document.getElementById('idTextBox');
            var weightTextBox = document.getElementById('weightTextBox');
            var submit = document.getElementById('submit');
            var inputForm = document.getElementById('inputForm');
            var hiddenTextBox = document.getElementById('hiddenTextBox');

            idTextBox.addEventListener('input', (event) => { 
                weightTextBox.value = event.target.value;
            })

            inputForm.addEventListener('submit', (event) => 
            {
                var id = idTextBox.value;
                var weight = weightTextBox.value;

                if (id != '' && weight != '')
                {
                    socket.emit('submit', { id , weight });
                }
                else
                {
                    alert("Input invalid!\nid or weight is not allowed to be empty");
                }
                
                event.preventDefault();
            })

            socket.on('userCount', function(data) { 
                console.log(data); 
                display.textContent = 'There are ' + data.message.userCount + ' users and value is ' + data.message.value;
                button.textContent = data.message.nameButton;
                button.addEventListener('click', (e) => {
                    e.preventDefault();
                    socket.emit('click', { message: 1 })
                })
            });

            // set focus hidden input
            var waiting = true;
            setInterval(() => {
                if (waiting) 
                {
                    idTextBox.style.visibility = "hidden";
                    idTextBox.focus();
                }
            }, 1000);
        </script>
    </body>
</html>